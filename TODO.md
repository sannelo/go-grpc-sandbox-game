# TODO roadmap

- [x] 1. Компактация RegionFile
  - Реализовать `Compact()` в `RegionFile` (копирование живых дельт → tmp → rename).
  - Триггер из `RegionManager` по росту файла или таймеру.

- [x] 2. Точный LRU-cleanup `BinaryStorage.deltaCache`
  - Поддерживать `AccessTime` при каждом обращении.
  - Периодический воркер удаляет фиксированное N старейших «чистых» дельт, а не половину карты.

- [x] 3. Оптимизировать ключи блоков
  - Заменить строковый `"x:y"` → `uint16` (`x<<8|y`).
  - Обновить сериализацию/десериализацию, тесты.

- [ ] 4. Улучшить LRU `RegionManager`
  - Хранить флаг `dirty`, чтобы не выгружать регионы с несохранёнными изменениями.
  - При выгрузке вызывать `RegionFile.Sync()`.

- [x] 5. Удалить `time.Sleep(1s)` при shutdown сервера
  - Положиться на `worldService.Stop()` и `BinaryStorage.Close()`.

- [ ] 6. Оптимизировать рассылку позиций игроков
  - Throttle: не чаще N раз/сек.
  - Фильтр по зоне видимости (радиус чанков).

- [ ] 7. **(Отдельно) Интеграционные тесты**
  - Сервер + 2 fake-клиента, проверка PlayerUpdate, перезапись дельт и компактация. 